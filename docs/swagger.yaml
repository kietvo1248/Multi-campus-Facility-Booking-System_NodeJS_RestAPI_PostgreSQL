openapi: 3.0.0
info:
  title: FPTU Facility Booking System API
  description: |
    Tài liệu API cho hệ thống đặt phòng FPTU Multi-campus.
    
    Cơ chế xác thực: **Cookie (HttpOnly)**.
    - Web Browser: Tự động gửi Cookie sau khi đăng nhập.
    - Swagger UI/Postman: Cần lấy Cookie từ DevTools và nhập vào nút Authorize.
  version: 1.0.0
servers:
  - url: http://localhost:6969/api
    description: Local Development Server

# --- CẤU HÌNH BẢO MẬT (COOKIE) ---
components:
  securitySchemes:
    cookieAuth:
      type: apiKey
      in: cookie
      name: access_token # Tên Cookie chứa JWT
      description: >
        Nhập giá trị của cookie `access_token` vào đây để test trên Swagger.
        (Thực tế trình duyệt sẽ tự gửi, không cần nhập).

  # --- ĐỊNH NGHĨA DATA MODELS (SCHEMAS) ---
  schemas:
    # 1. Model Input khi đăng nhập thường
    LoginInput:
      type: object
      required:
        - email
        - password
      properties:
        email:
          type: string
          format: email
          example: "admin@fpt.edu.vn"
          description: "Email của user"
        password:
          type: string
          format: password
          example: "123456"
          description: "Mật khẩu đăng nhập"

    # 2. Model User
    User:
      type: object
      properties:
        id:
          type: integer
          example: 1
        fullName:
          type: string
          example: "Nguyen Van Admin"
        email:
          type: string
          format: email
          example: "admin@fpt.edu.vn"
        role:
          type: string
          enum: [STUDENT, LECTURER, FACILITY_ADMIN]
          example: "FACILITY_ADMIN"
        campusId:
          type: integer
          example: 1
        campus:
          type: string
          description: "Tên campus"
          example: "FPTU HCM - Quan 9"
        isActive:
          type: boolean
          example: true

    # 3. Model Response (Trả về User + Info Cookie)
    LoginResponse:
      type: object
      properties:
        message:
          type: string
          example: "Đăng nhập thành công"
        user:
          $ref: '#/components/schemas/User'
      description: "Lưu ý: Token thực tế nằm trong Header `Set-Cookie`, không nằm trong body này."

    # 4. Model Lỗi chung
    ErrorResponse:
      type: object
      properties:
        status:
          type: integer
          example: 401
        message:
          type: string
          example: "Thông tin đăng nhập không chính xác hoặc Cookie hết hạn."

# --- ĐỊNH NGHĨA CÁC API (PATHS) ---
paths:
  # ==================================
  # 1. ĐĂNG NHẬP THƯỜNG (Email/Pass)
  # ==================================
  /auth/login:
    post:
      summary: Đăng nhập hệ thống (Email/Password)
      description: >
        Xác thực user nội bộ. 
        Nếu thành công, Server trả về header `Set-Cookie: access_token=...; HttpOnly`.
      tags:
        - Authentication
      security: [] # Public API
      requestBody:
        description: Thông tin đăng nhập
        required: true
        content:
          application/json:
            schema:
              $ref: '#/components/schemas/LoginInput'
      responses:
        '200':
          description: Đăng nhập thành công. Kiểm tra Header để thấy Cookie.
          headers: 
            Set-Cookie:
              schema: 
                type: string
                example: access_token=eyJhbGci...; Path=/; HttpOnly
              description: Cookie chứa JWT token.
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/LoginResponse'
        '401':
          description: Sai thông tin
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ErrorResponse'

  # ==================================
  # 2. ĐĂNG NHẬP GOOGLE (Quy trình Redirect)
  # ==================================
  /auth/google/login:
    get:
      summary: Bước 1 - Chuyển hướng sang Google Login
      description: >
        User click nút "Login Google". API này nhận `campusId`, lưu state,
        và trả về HTTP 302 để trình duyệt chuyển sang trang Google.
      tags:
        - Authentication
      security: [] # Public API
      parameters:
        - in: query
          name: campusId
          schema:
            type: integer
          required: true
          description: "ID Campus user chọn (VD: 1=HN, 2=HCM)"
          example: 2
      responses:
        '302':
          description: Redirect sang Google Accounts (https://accounts.google.com/...)

  /auth/google/callback:
    get:
      summary: Bước 2 - Google gọi lại & Set Cookie
      description: >
        Google redirect về đây kèm `code`. 
        Backend đổi code lấy token, tìm user trong DB.
        
        - Thành công: Redirect về trang chủ + Set Cookie.
        - Thất bại: Redirect về trang Login + Lỗi.
      tags:
        - Authentication
      security: []
      parameters:
        - in: query
          name: code
          schema:
            type: string
          description: "Auth Code từ Google"
        - in: query
          name: state
          schema:
            type: string
          description: "State bảo mật"
      responses:
        '302':
          description: >
            Đăng nhập thành công.
            Headers: `Set-Cookie: access_token=...`
            Location: `http://localhost:3000/home`

  # ==================================
  # 3. XEM PROFILE (Protected by Cookie)
  # ==================================
  /auth/profile:
    get:
      summary: Xem thông tin cá nhân (My Profile)
      description: >
        Lấy thông tin User hiện tại.
        Trình duyệt tự động gửi Cookie `access_token`.
      tags:
        - User Profile
      security:
        - cookieAuth: [] # Yêu cầu Cookie
      responses:
        '200':
          description: Lấy thông tin thành công
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/User'
        '401':
          description: Chưa đăng nhập hoặc Cookie hết hạn
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ErrorResponse'